# 도커 스웜 
# 도커 스웜을 사용하는 이유 

하나의 호스트 머신에서 도커 엔진을 구동하다가 CPU 메모리, 디스크 용량과 같은 자원이 부족하면 

* 스케일 업 
* 스케일 아웃(클러스터로 구성)
 
서버를 병렬로 확장해나가면     
적당한 성능의 서버 여러대를 하나의 자원 풀을 만들어 사용할 수 있고 성능이 좋은 값 비싼 서버를 사지 않아도 된다.         

**그러나, 여러대의 서버를 하나의 자원 풀로 만드는 것은 쉬운 작업이 아니다.**       
새로운 서버나 컨테이너가 추가됐을 때 이를 발견(Service Discovery)하는 작업부터   
어떤 서버에 컨테이너를 할당할 것인가에 대한 스케줄러와 로드밸런서 문제,      
클러스터 내의 서버가 다운 됐을 때 **고가용성**을 어떻게 보장할지 등이 문제로 남아있다.      

다행히도 이러한 문제를 해결하는 여러 솔루션을 오픈소스로 활용할 수 있는데   
도커에서 공식적으로 제공하는 도커스웜과 스웜모드가 대표적이다.   

# 스웜 클래식과 도커 스웜 모드 

스웜 클래식/스웜 모드는 여러 대의 도커 서버를 하나의 클러스터로 만들어 컨테이너를 생성하는 여러 기능을 제공한다.       
컨테이너를 특정 도커 서버에 할당할 수 있고 유동적으로 서버를 확장시킬 수도 있다.    
그뿐만 아니라 스웜 클러스터에 등록된 서버의 컨테이너를 쉽게 관리할 수 있다.   
(서버 클러스터에서 컨테이너를 어떻게 다룰 수 있는지 기초적인 지식 쌓기에 적합하다.)   

도커 스웜에는 2가지 종류가 있다.   

1. 스웜 클래식 : 도커 버전 1.6 이후부터 사용할 수 있는 컨테이너로서의 스웜
2. 스웜 모드 : 도커 버전 1.12 이후부터 사용할 수 있는 도커 스웜 모드(Swarm)

## 스웜 클래식과 도커 스웜 모드의 목적

두 종류의 가장 큰 차이점은 **목적**이다.  
  
* 스웜 클래식 : 
    * 여러 도커 서버를 하나의 지점에서 사용하도록 단일 접근점을 제공    
    * docker run, docker ps 등 일반적인 도커 명령어와 도커 API로 클러스터의 서버를 제어하고 관리할 수 있음  
* 스웜 모드 : 
    * 마이크로 서비스 아키텍처의 컨테이너를 다루기 위한 클러스터링 기능에 초점  
    * 같은 컨테이너를 동시에 여러 개 생성해 필요에 따라 유동적으로 컨테이너의 수를 조절 

상황에 맞추어 사용하면 되지만, 스웤 모드가 확장성 안정성 등 여러 측면에서 비교적 뛰어나기에 스웜 모드 사용  

## 분산 코디네이터
> 에이전트와 같은 클러스터 툴이 별도로 구동 되느냐   

여러개의 도커 서버를 하나의 클러스터로 구성하려면 각종 정보를 저장하고 동기화하는 분산 코디네이터,   
클러스터 내의 서버를 관리하고 제어하는 매니저, 각 서버를 제어하는 에이전트가 반드시 있어야 한다.  

* 스웜 클래식 : 분산 코디네이터, 에에전트등이 별도로 실행되어야함  
* 스웜 모드 : 클러스터링을 위한 모든 도구가 도커 엔진 자체에 내장돼있어 쉽게 서버 클러스터 구축이 가능하다.  

```
분산 코디네이터는 클러스터에 영입할 새로운 서버의 발견, 클러스터의 각종 설정 저장, 데이터 동기화 등에 주로 이용된다.   
etcd, zookeeper, consul등이 대표적인 예이며, 스웜 클래식은 대부분 분산 코디네이터를 사용할 수 있다.    
스웜 모드는 분산 코디네이터를 별도로 구축하지 않아도 된다.
```

대규모 클러스터에서 서비스를 운영하는 것을 계획하고 있다면 스웜 클래식보다는 스웜 모드를 사용하는 것이 좋다.  
스웜 모드는 MSA 애플리케이션을 컨테이너로 구축할 수 있도록 도와줄 뿐만 아니라,       
**서비스 장애에 대비한 고가용성과 부하 분산을 위한 로드 밸런싱 기능 또한 제공하고 있기 때문이다.**   
(스웜 클래식도 가능하지만 스웜 모드를 추천)  

# 스웜 모드 

스웜 모드는 별도의 설치 고자ㅓㅇ이 필요하지 않으며, 도커 엔진 자체에 내장돼어 있다.   

```shell
docker info | grep Swarm
Swarm: inactive
```













