# 쿠버네티스 인사이드
## 쿠버네티스 구성 요소 확인(+EKS,AKS,GKE 관리형 쿠버네티스)   
### 쿠버네티스를 이루는 것들 

* API 서버
* etcd
* c-m
* sched
* coreDNS
* k-proxy
* CNI
* kubelet

### 구역을 나누는 네임스페이스(Namespace) 

* default : 기존 사용자가 배포하는 파드, 디폴로이먼트가 존재하는 네임스페이스
* kube-system : 쿠버네티스를 이루는 구성 요소들이 존재하는 네임스페이스 
* metalb-system : metalb 가 존재하는 네임스페이스 


```
kubectl get pods -n kube-system
```
* `-n` 를 생략하면 default 네임스페이스에서 파드들을 찾는다.   
* `-n kube-system`를 통해 쿠버 시스템의 구성 요소 파드들을 조회한다.  
* 벤더마다의 구성요소는 많이 다르긴 하지만, 이러한 요소들이 `kube-system`에 있다는 것을 기억하자. 

## 쿠버네티스의 기본 철학

MSA 형태로 구성되어 있음(하는 일들이 기능별로 나뉘어짐) 

### 파드가 배포되면 

1. 사용자 : kubectl create pod(s) 입력 
2. MasterNode - API 서버 & etcd : 
    * 사용자의 명령이 API 서버로 넘겨온다.    
    * 상식적으로 API 서버가 컨트롤러 매니저에게 명령을 내릴 것이라 예상이 된다.  
    * 그러나 API 서버는 움직이지 않고 나무처럼 굳건히 가만히 있는 존재다.   
    * 오히려 파드가 생성 되었는지 컨트롤러 매니저를 감시한다.   
3. MasterNode - 컨트롤러 매니저 : 
    * API 서비 & etcd 가 내부 값을 가지고 있는지 확인한다.   
    * 값을 가지고 있다면, 값에 따른 동작을 처리한다(파드 생성)
    * 정확히 말하면, ReplicaSet과 같은 컨트롤러를 활용하고 거기서 사용된 값을 API 서버에 저장시킨다.  
4. MasterNode - API 서버 & etcd :   
    * 새로운 파드가 워커 노드에 들어갔는지 감시한다. 
5. MasterNode - 스케줄러 : 
    * 각 파드들을 배포하고 스케줄 하는 것까지만 담당을 한다.   
    * 스케줄러가 API 서버에 와서 바뀐게 있는지 값만 확인하고 새로운 파드를 워커노드에 넣도록 스케줄만 한다.
6. MasterNode - API 서버 & etcd :   
    * 새로운 파드가 워커 노드에 들어갔는지 감시한다. 
7. WorkerNode - kubelet : 
    * 컨테이너 런타임을 통해 파드의 동작이나 생성을 담당함(정확히는 동작관리만 담당)    
    * 사실 kubelet이 작업하는 것이 아니라 컨테이너 런타임이 생성을 담당하는 것임    
    * 파드가 생성되면 API 서버에 파드 상태 정보를 전달한다.     

쿠버네티스는 선언적인 시스템을 사용한다.    

### API 서버와 etcd

API 서버는 가지고 있는 현재 상태를 추구하는 값들을 가지고 있는데   
이 값들이 휘발될 수 있으므로 etcd에 저장을 한다.

1. API -> etcd ; 클러스터의 업데이트된 정보 기록
2. API <- etcd : API서버에 업데이트 되었음을 알림

## 실제 쿠버네티스의 파드 배포 흐름











